# TODO: come up with a nice-looking generic placeholder icon/label to go here
metadata:
  title: |
    CourtFormsOnline: MassAccess
  short title: |
    CourtFormsOnline
  title url: https://courtformsonline.org
  logo: |
    <img src="/packagestatic/docassemble.AssemblyLine/ma_logo.png" class="ma_icon" alt="Assembly Line Logo"><div class="title">CourtFormsOnline</div>
  exit url: https://courtformsonline.org
---
default screen parts:
  continue button label: |
    Next
  back button label: |
    Undo
  corner back button label: |
    Undo
  pre: |
    % if get_config('debug'):
    `id: ${ user_info().question_id }`  
    `Package: ${ user_info().package } ${ package_version_number }; ${ al_version }`
    
    [:save: Take Snapshot (dev)](${ url_ask(al_sessions_url_ask_snapshot) })
    <span style="margin-right: 1em"></span>
    [:fast-forward: Fast forward (dev)](${ url_ask(al_sessions_url_ask_fast_forward) })
    <div data-variable="${ encode_name(str( user_info().variable )) }" id="sought_variable" aria-hidden="true" style="display: none;"></div>
    % endif
  # We need both pre and post until old interviews are updated to v2 of the testing framework or v1 of the testing framework is updated. In future, we will need this in `post` so that it will work on signature pages.
  post: |
    <div data-variable="${ encode_name(str( user_info().variable )) }" id="trigger" aria-hidden="true" style="display: none;"></div>
---
features:
  small screen navigation: dropdown
  navigation back button: False
  javascript:
    - al_audio.js
    - docassemble.ALToolbox:copy_button.js
  css:
    - styles.css
    - al_audio.css
    - docassemble.ALToolbox:copy_button.css
    - docassemble.ALToolbox:collapse_template.css
  question help button: True
  question back button: True
  progress bar: True
---
code: |
  send_icon = "envelope"
---
code: |
  # Override this in your package where possible, so that 
  # features that depend on the package name will work
  # from the playground
  package_name = str(user_info().package)
---
code: |
  if package_name and not "playground" in package_name:
    github_repo_name = package_name.replace('.','-')
  else:    
    github_repo_name = "docassemble-AssemblyLine"
---
code: |
  # Username or organization name for Github repositories
  # Used to direct feedback to the right place and to check for
  # the last commit date.
  github_user = "suffolklitlab" 
---
code: |
  feedback_form = "docassemble.AssemblyLine:feedback.yml"
---
default screen parts:
  under: |
    % if not user_logged_in():
    [:sign-in-alt: Sign-in](${url_of('login', next=interview_url())}) or [register](${url_of('register', next=interview_url())}) to save your progress (optional).
    % endif
  footer: |
    [:share-alt-square: Share](${ url_ask([{'undefine': ['al_sharing_type','al_how_share_link']}, 'al_share_form_screen', {'recompute': ['al_did_share_form']}, 'al_share_results']) })
    [:info-circle: About](${ url_action('about_this_interview') })
    [:comment-dots: Feedback](${ feedback_link(user_info(), i=feedback_form, github_repo=github_repo_name, github_user=github_user, package_version=package_version_number) } ){:target="_blank"}
---
image sets:
  smashicons:
    attribution: |
      Icon made by
      [Smashicons](https://www.flaticon.com/authors/smashicons)
    images:
      form: sign-form.svg
      form-lineal: sign-form-lineal.svg
---
continue button field: al_share_form_screen
id: al share form screen
question: |
  Share this website
fields:
  - What do you want to do?: al_sharing_type
    datatype: radio
    choices:
      - Tell a friend about this website: tell_friend
      - Share my answers and progress with someone: share_answers
  -  How do you want to share the link?: al_how_share_link
     datatype: radio
     choices:
       - Email or text message: email_or_sms
       - Just show me the link. I will share it myself.: link_only
     js show if: |
       val("al_sharing_type") === "tell_friend" || val("al_sharing_type") === "share_answers" 
  - note: |
      **Note**: the person you share this link with will be able to see and
      edit your answers on this form.
    show if:
      variable: al_sharing_type
      is: share_answers
  - note: |
      You can copy and share this link
      
      ${ copy_button_html(  interview_url(i=user_info().filename, style="short", new_session=1), label=al_copy_button_label.show(), tooltip_inert_text=al_copy_button_tooltip_inert_text.show(), tooltip_copied_text = al_copy_button_tooltip_copied_text.show() ) }
    js show if: |
      val("al_sharing_type") === "tell_friend" && val("al_how_share_link") === "link_only"      
  - note: |
      You can copy and share this link (expires in 48 hours)
      ${ copy_button_html( interview_url(temporary=48), label=al_copy_button_label.show(), tooltip_inert_text=al_copy_button_tooltip_inert_text.show(), tooltip_copied_text = al_copy_button_tooltip_copied_text.show()) }
    js show if: |
      val("al_sharing_type") === "share_answers" && val("al_how_share_link") === "link_only"
  - Email or phone number you want to send this to: share_interview_contact_method
    validate: is_phone_or_email
    show if:
      variable: al_how_share_link
      is: email_or_sms
  - Message: tell_a_friend_message
    datatype: area
    default: |
      Hi, I wanted to let you know about a free website that I learned about:
      "${single_paragraph(all_variables(special='metadata').get('title','Court Forms Online'))}". I think this might
      help you, too. Check it out at the link in this message:       
    js show if: |
      val("al_how_share_link") === "email_or_sms" && val("al_sharing_type") === "tell_friend"
  - Message: share_interview_answers_message
    datatype: area
    default: |
      Hi, I wanted to share my progress on a form on Court Forms Online,
      "${single_paragraph(all_variables(special='metadata').get('title','Court Forms Online'))}".
      If you click this link, you can follow along or finish the form for me.
    js show if: |
      val("al_how_share_link") === "email_or_sms" && val("al_sharing_type") === "share_answers"      
  - Your name: al_share_form_from_name
    default: ${ str(users[0]) if defined('users[0].name.first') else '' } 
    show if:
      variable: al_how_share_link
      is: email_or_sms    
back button label: |
  Back to your form
---
id: Results of sharing
continue button field: al_share_results
question: |
  % if al_sharing_type == 'tell_friend':
  Thanks for sharing!
  % elif al_how_share_link == 'link_only':
  Do not forget to send the link!
  % else:
  Your message is on its way
  % endif
subquestion: |
  % if al_sharing_type == 'share_answers':
  **Keep in mind**: when you make a change to your form, the
  person you shared it with will see the change you made. You will
  also see any changes that person makes.
  % endif
  
  Click "Next" to go back to your form in progress.
---
need:
  - al_share_answers_message_template
  - al_tell_a_friend_message_template
code: |
  if al_how_share_link == 'email_or_sms':
    if phone_number_is_valid(share_interview_contact_method):
      if al_sharing_type == "tell_friend":
        success = send_sms(to=share_interview_contact_method, template=al_tell_a_friend_message_template)
      else:
        success = send_sms(to=share_interview_contact_method, template=al_share_answers_message_template)
    else:
      if al_sharing_type == "tell_friend":
        success = send_email(to=share_interview_contact_method, template=al_tell_a_friend_message_template)
      else:
        success = send_email(to=share_interview_contact_method, template=al_share_answers_message_template)
  al_did_share_form = True
---
##########
# Copy button strings for translation
---
template: al_copy_button_label
content: |
  Copy
---
template: al_copy_button_tooltip_inert_text
content: |
  Copy to clipboard
---
template: al_copy_button_tooltip_copied_text
content: |
  Copied!
---
##############
# Sharing email templates
---
template: al_share_answers_message_template
subject: |
  Court Forms Online form from ${ al_share_form_from_name }
content: |
  ${ share_interview_answers_message }
  Click the link below to view and edit ${ al_share_form_from_name }'s
  progress so far:
  
  ${ interview_url(temporary=48) }
---
template: al_tell_a_friend_message_template
subject: |
  ${ al_share_form_from_name } wants to tell you about Court Forms Online
content: |
  ${ tell_a_friend_message }
  ${ interview_url(i=user_info().filename, style="short", new_session=1) }
---
code: |
  github_url = "https://github.com/" + github_user + "/" + github_repo_name
---
code: |
  res = github_modified_date(github_user, github_repo_name)
  if res:
    package_updated_on = res.format('yyyy-MM-dd')
  else:
    package_updated_on = None
---
event: about_this_interview
id: about AssemblyLine project
question: |
  About this form
# TODO: I think people might want more form-specific info here?
# It is easy to copy and edit this event without removing the version
# information. We may consider using the form description, adding a 
# thumbnail of the original form, etc. at some point.
subquestion: |  
  ${ about_this_interview_version_info }
back button label: |
  Back to form
---
template: about_this_interview_version_info
content: |
  "${all_variables(special='metadata').get('title','').rstrip()}" version 
  `${ package_version_number }`; AssemblyLine version `${ al_version }`.
  
  % if package_updated_on:
  Last updated on ${ package_updated_on }. [:fab-fa-github: View code on GitHub](${ github_url }).  
  % endif

  [Submit feedback](${ interview_url(i=feedback_form, github_repo=github_repo_name, github_user=github_user, variable=user_info().variable, question_id=user_info().question_id, package_version=package_version_number, local=False,reset=1) } ){:target="_blank"}.

  % if all_variables(special='metadata').get('authors'):
  This form was authored by ${ comma_and_list(all_variables(special='metadata').get('authors')) }.
  % endif
  
  "${all_variables(special='metadata').get('title','').rstrip()}" includes code 
  from the [Document Assembly Line project](https://suffolklitlab.org/docassemble-AssemblyLine-documentation/docs/). 